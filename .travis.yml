language:
  - cpp
  - c
notifications:
  email: false
  irc: "chat.freenode.net#stepmania"

os:
  - linux
  - osx
  - windows

env:
  - BUILD_TYPE=Release
#  - BUILD_TYPE=Debug

compiler:
  - gcc
  - clang

addons:
  apt:
    packages:
      - libasound2-dev
      - libglew-dev
      - libmad0-dev
      - libpulse-dev
      - libva-dev
      - libvorbis-dev
      - libxinerama-dev
      - libxrandr-dev
      - libvdpau-dev
      - libxv-dev
      - nasm
      - ninja-build
#      - libavcodec-dev
#      - libswscale-dev
#      - libavutil-dev
#      - libavformat-dev

matrix:
  exclude:
    - os: osx
      compiler: gcc

before_install:
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew update; fi

install:
#  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew install ffmpeg; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew install nasm; fi
#  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew install ninja; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then choco install nsis -version 2.46.0.20150406; fi

before_script:
  - cd Build
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then export SDKROOT=$(xcodebuild -version -sdk macosx Path); fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then export MACOSX_DEPLOYMENT_TARGET=10.13; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then export CMAKE_MAKE_PROGRAM=Xcode; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then export CMAKE_MAKE_PROGRAM=Ninja; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then export CMAKE_MAKE_PROGRAM="Visual Studio 15 2017"; fi
  - cmake .. -G"${CMAKE_MAKE_PROGRAM}"
    -DCMAKE_C_COMPILER=${CC} -DCMAKE_CXX_COMPILER=${CXX}

script:
  - travis_wait cmake --build . --target ffmpeg_ext
  - cmake ..
  - cmake --build .
